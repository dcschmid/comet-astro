---
interface Props {
  variant?: 'default' | 'primary' | 'success' | 'warning' | 'error';
  size?: 'sm' | 'md' | 'lg';
  removable?: boolean;
  href?: string;
  className?: string;
}

const {
  variant = 'default',
  size = 'md',
  removable = false,
  href,
  className = '',
} = Astro.props;

// Adjusted palettes for ≥7:1 contrast with text in both themes.
// default: neutral subtle surface with dark/light appropriate text.
// primary/success/error: saturated backgrounds with white text (≥7:1) & hover slightly lighter but still ≥5+ while base stays ≥7.
// warning: amber spectrum often lower contrast; use deeper shade for base + switch to slate-50 text.
const variantClasses = {
  default:
    'border border-slate-400 bg-slate-100 text-slate-900 hover:bg-slate-200 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100 dark:hover:bg-slate-700',
  primary:
    'border border-blue-700 bg-blue-700 text-slate-50 hover:bg-blue-600 dark:border-blue-500 dark:bg-blue-600 dark:hover:bg-blue-500',
  success:
    'border border-emerald-700 bg-emerald-700 text-slate-50 hover:bg-emerald-600 dark:border-emerald-600 dark:bg-emerald-600 dark:hover:bg-emerald-500',
  warning:
    'border border-amber-700 bg-amber-700 text-slate-50 hover:bg-amber-600 dark:border-amber-600 dark:bg-amber-600 dark:hover:bg-amber-500',
  error:
    'border border-rose-700 bg-rose-700 text-slate-50 hover:bg-rose-600 dark:border-rose-600 dark:bg-rose-600 dark:hover:bg-rose-500',
};

const sizeClasses = {
  sm: 'px-2 py-0.5 text-xs',
  md: 'px-3 py-1 text-sm',
  lg: 'px-4 py-1.5 text-base',
};

const Tag = href ? 'a' : 'span';
---

<Tag
  href={href}
  class={`inline-flex items-center gap-1.5 rounded-full font-semibold transition ${variantClasses[variant]} ${sizeClasses[size]} focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-slate-900 ${className}`}
>
  <slot />
  {
    removable && (
      <button
        type="button"
        class="ml-0.5 inline-flex h-4 w-4 items-center justify-center rounded-full border border-transparent text-xs font-semibold transition hover:scale-105 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-slate-900"
        aria-label="Remove"
        data-chip-remove
      >
        ✕
      </button>
    )
  }
</Tag>

<script is:inline>
  (() => {
    const script = document.currentScript;
    if (!(script instanceof HTMLScriptElement)) return;
    const chip = script.previousElementSibling;
    if (!(chip instanceof HTMLElement)) return;
    const removeBtn = chip.querySelector('[data-chip-remove]');
    if (!(removeBtn instanceof HTMLElement)) return;
    removeBtn.addEventListener('click', () => {
      chip.remove();
    });
  })();
</script>
