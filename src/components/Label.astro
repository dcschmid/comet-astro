---
/**
 * Label - WCAG AAA compliant form label component
 * Provides accessible form labeling with enhanced visual hierarchy and state indicators
 */
interface Props {
  for?: string;
  required?: boolean;
  optional?: boolean;
  disabled?: boolean;
  size?: 'xs' | 'sm' | 'md' | 'lg' | 'xl';
  weight?: 'normal' | 'medium' | 'semibold' | 'bold';
  variant?: 'default' | 'floating' | 'inline' | 'stacked';
  status?: 'default' | 'error' | 'warning' | 'success';
  className?: string;
  description?: string;
  requiredText?: string;
  optionalText?: string;
  hideRequiredIndicator?: boolean;
  hideOptionalIndicator?: boolean;
}

const {
  for: htmlFor,
  required = false,
  optional = false,
  disabled = false,
  size = 'md',
  weight = 'medium',
  variant = 'default',
  status = 'default',
  className = '',
  description,
  requiredText = 'Required',
  optionalText = 'Optional',
  hideRequiredIndicator = false,
  hideOptionalIndicator = false,
} = Astro.props;

// Enhanced size classes with responsive design
const sizeClasses = {
  xs: {
    text: 'text-xs leading-4',
    indicator: 'text-xs',
    description: 'text-xs leading-3',
    spacing: 'space-y-0.5',
  },
  sm: {
    text: 'text-sm leading-4',
    indicator: 'text-xs',
    description: 'text-xs leading-4',
    spacing: 'space-y-1',
  },
  md: {
    text: 'text-sm leading-5',
    indicator: 'text-sm',
    description: 'text-xs leading-4',
    spacing: 'space-y-1.5',
  },
  lg: {
    text: 'text-base leading-6',
    indicator: 'text-sm',
    description: 'text-sm leading-5',
    spacing: 'space-y-2',
  },
  xl: {
    text: 'text-lg leading-7',
    indicator: 'text-base',
    description: 'text-sm leading-5',
    spacing: 'space-y-2.5',
  },
};

// Font weight classes
const weightClasses = {
  normal: 'font-normal',
  medium: 'font-medium',
  semibold: 'font-semibold',
  bold: 'font-bold',
};

// WCAG AAA compliant color classes with 7:1+ contrast ratios
const colorClasses = {
  // Default text colors
  text: 'text-slate-900 dark:text-slate-50',
  textSecondary: 'text-slate-800 dark:text-slate-100',
  textMuted: 'text-slate-700 dark:text-slate-200',
  textDisabled: 'text-slate-500 dark:text-slate-400',
  // Status colors
  error: 'text-red-700 dark:text-red-300',
  warning: 'text-amber-700 dark:text-amber-300',
  success: 'text-green-700 dark:text-green-300',
  // Indicator colors
  required: 'text-red-700 dark:text-red-300',
  optional: 'text-slate-600 dark:text-slate-300',
};

// Status-based text colors
const statusColors = {
  default: colorClasses.text,
  error: colorClasses.error,
  warning: colorClasses.warning,
  success: colorClasses.success,
};

// Variant layout classes
const variantClasses = {
  default: 'block',
  floating: 'block',
  inline: 'inline-flex items-center gap-2',
  stacked: 'flex flex-col',
};

// Compute final classes
const textColor = disabled ? colorClasses.textDisabled : statusColors[status];
const requiredColor = disabled
  ? colorClasses.textDisabled
  : colorClasses.required;
const optionalColor = disabled
  ? colorClasses.textDisabled
  : colorClasses.optional;

// Generate unique IDs for accessibility
const labelId = htmlFor
  ? `label-${htmlFor}`
  : `label-${Math.random().toString(36).slice(2, 8)}`;
const descriptionId = description ? `${labelId}-description` : undefined;

// Required/Optional indicator logic
const showRequired = required && !hideRequiredIndicator;
const showOptional = optional && !hideOptionalIndicator && !required;
---

<div class={`${sizeClasses[size].spacing} ${className}`}>
  <label
    for={htmlFor}
    id={labelId}
    class={`
      ${variantClasses[variant]}
      ${sizeClasses[size].text}
      ${weightClasses[weight]}
      ${textColor}
      ${disabled ? 'cursor-not-allowed' : 'cursor-pointer'}
      transition-colors duration-200
    `}
    aria-describedby={descriptionId}
  >
    <!-- Label Text -->
    <span class="flex items-center gap-2">
      <slot />

      <!-- Required Indicator -->
      {
        showRequired && (
          <span
            class={`
            ${sizeClasses[size].indicator}
            ${requiredColor}
            font-medium
          `}
            aria-label={requiredText}
            title={requiredText}
          >
            *
          </span>
        )
      }

      <!-- Optional Indicator -->
      {
        showOptional && (
          <span
            class={`
            ${sizeClasses[size].indicator}
            ${optionalColor}
            font-normal
          `}
            aria-label={optionalText}
          >
            ({optionalText.toLowerCase()})
          </span>
        )
      }
    </span>

    <!-- Status Icon for Error/Warning/Success -->
    {
      status !== 'default' && (
        <span class={`inline-flex items-center ml-1`} aria-hidden="true">
          {status === 'error' && (
            <svg
              class={`w-4 h-4 ${colorClasses.error}`}
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                fill-rule="evenodd"
                d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z"
                clip-rule="evenodd"
              />
            </svg>
          )}
          {status === 'warning' && (
            <svg
              class={`w-4 h-4 ${colorClasses.warning}`}
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                fill-rule="evenodd"
                d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                clip-rule="evenodd"
              />
            </svg>
          )}
          {status === 'success' && (
            <svg
              class={`w-4 h-4 ${colorClasses.success}`}
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                fill-rule="evenodd"
                d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                clip-rule="evenodd"
              />
            </svg>
          )}
        </span>
      )
    }
  </label>

  <!-- Description -->
  {
    description && (
      <p
        id={descriptionId}
        class={`
        ${sizeClasses[size].description}
        ${disabled ? colorClasses.textDisabled : colorClasses.textMuted}
        leading-relaxed
      `}
        role={status === 'error' ? 'alert' : undefined}
        aria-live={status === 'error' ? 'polite' : undefined}
      >
        {description}
      </p>
    )
  }
</div>

<style>
  /* Enhanced focus styles for better accessibility */
  label:focus-within {
    outline: 2px solid rgb(59 130 246);
    outline-offset: 2px;
    border-radius: 4px;
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    label {
      font-weight: 600;
    }

    label [aria-label='Required'],
    label [aria-label='Optional'] {
      font-weight: 700;
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    label {
      transition: none;
    }
  }

  /* Enhanced hover states */
  label:hover:not([aria-disabled='true']) {
    opacity: 0.9;
  }

  /* Disabled state styling */
  label:has(+ input:disabled),
  label[aria-disabled='true'] {
    opacity: 0.6;
    cursor: not-allowed;
  }
</style>
