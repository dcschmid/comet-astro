---
/**
 * MusicButtons - Enhanced music platform buttons with WCAG AAA compliance
 */

interface PlatformLink {
  platform: string;
  href: string;
  label?: string;
}

interface Props {
  // Content
  links: PlatformLink[];

  // Layout
  layout?: 'row' | 'column' | 'wrap' | 'grid';
  size?: 'sm' | 'md' | 'lg';

  // Styling
  variant?: 'default' | 'minimal' | 'filled';

  // Accessibility
  ariaLabel?: string;
  showIcons?: boolean;

  // Classes
  class?: string;
  className?: string;
}

const {
  links = [],
  layout = 'row',
  size = 'md',
  variant = 'default',
  ariaLabel = 'Music platforms',
  showIcons = true,
  class: className,
  className: legacyClassName,
} = Astro.props;

const finalClassName = className || legacyClassName || '';

// Size styles with WCAG AAA compliant touch targets
const sizeClasses = {
  sm: 'min-h-[44px] px-3 py-2 text-sm gap-2',
  md: 'min-h-[48px] px-4 py-3 text-base gap-3',
  lg: 'min-h-[52px] px-6 py-4 text-lg gap-3',
};

// Layout styles - responsive by default
const layoutClasses = {
  row: 'flex flex-row flex-wrap gap-3',
  column: 'flex flex-col gap-3',
  wrap: 'flex flex-wrap gap-3',
  grid: 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3',
};

// Base button styles with enhanced accessibility
const baseButtonClasses = `
  inline-flex items-center justify-center rounded-lg border font-semibold 
  no-underline transition-all duration-200 
  focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2
  dark:focus:ring-offset-gray-900
  hover:transform hover:scale-[1.02] 
  active:scale-[0.98]
`
  .trim()
  .replace(/\s+/g, ' ');

// Platform colors with WCAG AAA contrast ratios (7:1+)
const platformStyles = {
  spotify: {
    default:
      'border-green-600 bg-green-50 text-green-900 hover:bg-green-100 dark:border-green-400 dark:bg-green-950 dark:text-green-50 dark:hover:bg-green-900',
    minimal:
      'border-green-600 bg-transparent text-green-700 hover:bg-green-50 dark:border-green-400 dark:text-green-300 dark:hover:bg-green-950',
    filled:
      'border-green-600 bg-green-600 text-white hover:bg-green-700 dark:border-green-500 dark:bg-green-600 dark:hover:bg-green-500',
  },
  apple: {
    default:
      'border-gray-800 bg-gray-50 text-gray-900 hover:bg-gray-100 dark:border-gray-400 dark:bg-gray-950 dark:text-gray-50 dark:hover:bg-gray-900',
    minimal:
      'border-gray-800 bg-transparent text-gray-800 hover:bg-gray-50 dark:border-gray-400 dark:text-gray-300 dark:hover:bg-gray-950',
    filled:
      'border-gray-800 bg-gray-800 text-white hover:bg-gray-900 dark:border-gray-600 dark:bg-gray-700 dark:hover:bg-gray-600',
  },
  applemusic: {
    default:
      'border-gray-800 bg-gray-50 text-gray-900 hover:bg-gray-100 dark:border-gray-400 dark:bg-gray-950 dark:text-gray-50 dark:hover:bg-gray-900',
    minimal:
      'border-gray-800 bg-transparent text-gray-800 hover:bg-gray-50 dark:border-gray-400 dark:text-gray-300 dark:hover:bg-gray-950',
    filled:
      'border-gray-800 bg-gray-800 text-white hover:bg-gray-900 dark:border-gray-600 dark:bg-gray-700 dark:hover:bg-gray-600',
  },
  youtube: {
    default:
      'border-red-600 bg-red-50 text-red-900 hover:bg-red-100 dark:border-red-400 dark:bg-red-950 dark:text-red-50 dark:hover:bg-red-900',
    minimal:
      'border-red-600 bg-transparent text-red-700 hover:bg-red-50 dark:border-red-400 dark:text-red-300 dark:hover:bg-red-950',
    filled:
      'border-red-600 bg-red-600 text-white hover:bg-red-700 dark:border-red-500 dark:bg-red-600 dark:hover:bg-red-500',
  },
  ytmusic: {
    default:
      'border-red-600 bg-red-50 text-red-900 hover:bg-red-100 dark:border-red-400 dark:bg-red-950 dark:text-red-50 dark:hover:bg-red-900',
    minimal:
      'border-red-600 bg-transparent text-red-700 hover:bg-red-50 dark:border-red-400 dark:text-red-300 dark:hover:bg-red-950',
    filled:
      'border-red-600 bg-red-600 text-white hover:bg-red-700 dark:border-red-500 dark:bg-red-600 dark:hover:bg-red-500',
  },
  soundcloud: {
    default:
      'border-orange-600 bg-orange-50 text-orange-900 hover:bg-orange-100 dark:border-orange-400 dark:bg-orange-950 dark:text-orange-50 dark:hover:bg-orange-900',
    minimal:
      'border-orange-600 bg-transparent text-orange-700 hover:bg-orange-50 dark:border-orange-400 dark:text-orange-300 dark:hover:bg-orange-950',
    filled:
      'border-orange-600 bg-orange-600 text-white hover:bg-orange-700 dark:border-orange-500 dark:bg-orange-600 dark:hover:bg-orange-500',
  },
  bandcamp: {
    default:
      'border-cyan-700 bg-cyan-50 text-cyan-900 hover:bg-cyan-100 dark:border-cyan-400 dark:bg-cyan-950 dark:text-cyan-50 dark:hover:bg-cyan-900',
    minimal:
      'border-cyan-700 bg-transparent text-cyan-800 hover:bg-cyan-50 dark:border-cyan-400 dark:text-cyan-300 dark:hover:bg-cyan-950',
    filled:
      'border-cyan-700 bg-cyan-700 text-white hover:bg-cyan-800 dark:border-cyan-600 dark:bg-cyan-600 dark:hover:bg-cyan-500',
  },
  deezer: {
    default:
      'border-purple-700 bg-purple-50 text-purple-900 hover:bg-purple-100 dark:border-purple-400 dark:bg-purple-950 dark:text-purple-50 dark:hover:bg-purple-900',
    minimal:
      'border-purple-700 bg-transparent text-purple-800 hover:bg-purple-50 dark:border-purple-400 dark:text-purple-300 dark:hover:bg-purple-950',
    filled:
      'border-purple-700 bg-purple-700 text-white hover:bg-purple-800 dark:border-purple-600 dark:bg-purple-600 dark:hover:bg-purple-500',
  },
  tidal: {
    default:
      'border-gray-800 bg-gray-50 text-gray-900 hover:bg-gray-100 dark:border-gray-400 dark:bg-gray-950 dark:text-gray-50 dark:hover:bg-gray-900',
    minimal:
      'border-gray-800 bg-transparent text-gray-800 hover:bg-gray-50 dark:border-gray-400 dark:text-gray-300 dark:hover:bg-gray-950',
    filled:
      'border-gray-800 bg-gray-800 text-white hover:bg-gray-900 dark:border-gray-600 dark:bg-gray-700 dark:hover:bg-gray-600',
  },
};

// Default platform styling for unknown platforms
const defaultPlatformStyle = {
  default:
    'border-gray-600 bg-gray-50 text-gray-900 hover:bg-gray-100 dark:border-gray-400 dark:bg-gray-950 dark:text-gray-50 dark:hover:bg-gray-900',
  minimal:
    'border-gray-600 bg-transparent text-gray-700 hover:bg-gray-50 dark:border-gray-400 dark:text-gray-300 dark:hover:bg-gray-950',
  filled:
    'border-gray-600 bg-gray-600 text-white hover:bg-gray-700 dark:border-gray-500 dark:bg-gray-600 dark:hover:bg-gray-500',
};

// Platform icons (simple text-based for better accessibility)
const platformIcons = {
  spotify: '‚ô´',
  apple: 'üçé',
  applemusic: 'üçé',
  youtube: '‚ñ∂',
  ytmusic: '‚ñ∂',
  soundcloud: '‚òÅ',
  bandcamp: 'üéµ',
  deezer: '‚ô™',
  tidal: '„Äú',
};

function getPlatformStyle(platform: string): string {
  const key = platform.toLowerCase();
  const platformStyle = platformStyles[key as keyof typeof platformStyles];
  return platformStyle ? platformStyle[variant] : defaultPlatformStyle[variant];
}

function getPlatformIcon(platform: string): string {
  const key = platform.toLowerCase();
  return platformIcons[key as keyof typeof platformIcons] || '‚ô™';
}

function getDisplayLabel(link: PlatformLink): string {
  if (link.label) return link.label;

  // Friendly display names
  const platformNames = {
    spotify: 'Spotify',
    apple: 'Apple Music',
    applemusic: 'Apple Music',
    youtube: 'YouTube Music',
    ytmusic: 'YouTube Music',
    soundcloud: 'SoundCloud',
    bandcamp: 'Bandcamp',
    deezer: 'Deezer',
    tidal: 'Tidal',
  };

  const key = link.platform.toLowerCase();
  return platformNames[key as keyof typeof platformNames] || link.platform;
}
---

<nav
  class={`${layoutClasses[layout]} ${finalClassName}`.trim()}
  aria-label={ariaLabel}
  role="navigation"
>
  {
    links.map((link) => (
      <a
        href={link.href}
        target="_blank"
        rel="noopener noreferrer"
        class={`
        ${baseButtonClasses}
        ${sizeClasses[size]}
        ${getPlatformStyle(link.platform)}
      `
          .trim()
          .replace(/\s+/g, ' ')}
        data-platform={link.platform.toLowerCase()}
        aria-label={`Listen on ${getDisplayLabel(link)} (opens in new window)`}
      >
        {showIcons && (
          <span aria-hidden="true" class="text-current">
            {getPlatformIcon(link.platform)}
          </span>
        )}
        <span>{getDisplayLabel(link)}</span>
        <span class="sr-only">(opens in new window)</span>
      </a>
    ))
  }
</nav>
