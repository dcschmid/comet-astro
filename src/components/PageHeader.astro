---
import { cn } from '../utils/cn';

interface Props {
  // Content props
  title: string;
  subtitle?: string;
  eyebrow?: string;

  // Visual variants
  variant?: 'default' | 'centered' | 'minimal' | 'hero';
  size?: 'sm' | 'md' | 'lg' | 'xl';

  // Layout props
  alignment?: 'left' | 'center' | 'right';
  background?: 'none' | 'subtle' | 'pattern';

  // Accessibility props
  titleLevel?: 1 | 2 | 3 | 4 | 5 | 6;
  role?: string;
  ariaLabel?: string;
  ariaDescribedBy?: string;

  // Styling
  class?: string;
}

const {
  title,
  subtitle,
  eyebrow,
  variant = 'default',
  size = 'md',
  alignment = 'left',
  background = 'none',
  titleLevel = 1,
  role,
  ariaLabel,
  ariaDescribedBy,
  class: className,
} = Astro.props as Props;

// Generate unique IDs for ARIA relationships
const headerId = `page-header-${Math.random().toString(36).substr(2, 9)}`;
const subtitleId = subtitle
  ? `subtitle-${Math.random().toString(36).substr(2, 9)}`
  : undefined;

// Variant styles
const variantStyles = {
  default: 'py-8 lg:py-12',
  centered: 'py-12 lg:py-16 text-center',
  minimal: 'py-6 lg:py-8',
  hero: 'py-16 lg:py-24 text-center',
};

// Size styles for title
const titleSizeStyles = {
  sm: 'text-2xl lg:text-3xl',
  md: 'text-3xl lg:text-4xl',
  lg: 'text-4xl lg:text-5xl xl:text-6xl',
  xl: 'text-5xl lg:text-6xl xl:text-7xl',
};

// Size styles for subtitle
const subtitleSizeStyles = {
  sm: 'text-sm lg:text-base',
  md: 'text-base lg:text-lg',
  lg: 'text-lg lg:text-xl',
  xl: 'text-xl lg:text-2xl',
};

// Background styles
const backgroundStyles = {
  none: '',
  subtle: 'bg-gray-50/50 dark:bg-gray-900/50',
  pattern:
    'bg-gradient-to-br from-gray-50 to-white dark:from-gray-900 dark:to-gray-800 relative overflow-hidden before:absolute before:inset-0 before:bg-grid-gray-100/50 dark:before:bg-grid-gray-800/50 before:bg-[size:20px_20px] before:opacity-40',
};

// Alignment styles
const alignmentStyles = {
  left: 'text-left',
  center: 'text-center',
  right: 'text-right',
};

// Dynamic title tag
const containerClasses = cn(
  'w-full',
  variantStyles[variant],
  backgroundStyles[background],
  alignmentStyles[alignment],
  // WCAG AAA compliant spacing and readability
  'focus-within:outline-none',
  className
);

const titleClasses = cn(
  titleSizeStyles[size],
  'font-bold tracking-tight leading-tight',
  // WCAG AAA contrast ratios
  'text-gray-900 dark:text-gray-50',
  // Responsive line height for readability
  'leading-[1.1] lg:leading-[1.1]'
);

const subtitleClasses = cn(
  subtitleSizeStyles[size],
  'leading-relaxed',
  // WCAG AAA contrast ratios - slightly muted but still accessible
  'text-gray-700 dark:text-gray-300',
  // Responsive spacing
  'mt-3 lg:mt-4'
);

const eyebrowClasses = cn(
  'text-sm font-medium uppercase tracking-wider',
  // WCAG AAA contrast ratios for accent text
  'text-blue-600 dark:text-blue-400',
  'mb-2 lg:mb-3'
);

// Determine max width based on alignment and variant
const getMaxWidth = () => {
  if (variant === 'centered' || variant === 'hero') {
    return 'max-w-4xl mx-auto';
  }
  if (alignment === 'center') {
    return 'max-w-4xl mx-auto';
  }
  return 'max-w-none';
};
---

<header
  class={containerClasses}
  role={role}
  aria-label={ariaLabel}
  aria-describedby={ariaDescribedBy || subtitleId}
>
  <div class={cn('px-4 sm:px-6 lg:px-8', getMaxWidth())}>
    <div class="space-y-1">
      {eyebrow && <div class={eyebrowClasses}>{eyebrow}</div>}

      {
        titleLevel === 1 && (
          <h1 id={headerId} class={titleClasses}>
            {title}
          </h1>
        )
      }
      {
        titleLevel === 2 && (
          <h2 id={headerId} class={titleClasses}>
            {title}
          </h2>
        )
      }
      {
        titleLevel === 3 && (
          <h3 id={headerId} class={titleClasses}>
            {title}
          </h3>
        )
      }
      {
        titleLevel === 4 && (
          <h4 id={headerId} class={titleClasses}>
            {title}
          </h4>
        )
      }
      {
        titleLevel === 5 && (
          <h5 id={headerId} class={titleClasses}>
            {title}
          </h5>
        )
      }
      {
        titleLevel === 6 && (
          <h6 id={headerId} class={titleClasses}>
            {title}
          </h6>
        )
      }

      {
        subtitle && (
          <p id={subtitleId} class={subtitleClasses}>
            {subtitle}
          </p>
        )
      }

      {
        Astro.slots.has('default') && (
          <div
            class={cn(
              'pt-4 lg:pt-6',
              alignment === 'center' ? 'flex justify-center' : '',
              alignment === 'right' ? 'flex justify-end' : ''
            )}
          >
            <slot />
          </div>
        )
      }
    </div>
  </div>
</header>
